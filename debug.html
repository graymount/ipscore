<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug IP Security Score</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            font-family: monospace;
            font-size: 12px;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }
        .log-entry.error {
            border-color: #e74c3c;
            background: #ffeaa7;
        }
        .log-entry.success {
            border-color: #27ae60;
            background: #d1f2eb;
        }
        .log-entry.info {
            border-color: #3498db;
            background: #e3f2fd;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>IP Security Score - Debug Mode</h1>
    
    <div class="debug-panel">
        <h2>System Check</h2>
        <div id="systemCheck"></div>
    </div>
    
    <div class="debug-panel">
        <h2>Actions</h2>
        <button onclick="testBasicFetch()">Test Basic Fetch</button>
        <button onclick="testIPDetection()">Test IP Detection</button>
        <button onclick="testFullInit()">Test Full Init</button>
        <button onclick="clearLogs()">Clear Logs</button>
        <button onclick="window.location.href='index.html'">Go to Main App</button>
    </div>
    
    <div class="debug-panel">
        <h2>Console Output</h2>
        <div id="debugLog"></div>
    </div>

    <script>
        // Override console.log to display in page
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const debugLog = document.getElementById('debugLog');
        
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugLog.appendChild(entry);
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        // System check
        function checkSystem() {
            const systemCheck = document.getElementById('systemCheck');
            const checks = [];
            
            // Check for required elements
            checks.push(`index.html loaded: ${!!window.parent.document}`);
            checks.push(`i18n.js loaded: ${typeof window.i18n !== 'undefined'}`);
            checks.push(`script.js loaded: ${typeof IPSecurityAnalyzer !== 'undefined'}`);
            
            // Check browser features
            checks.push(`Fetch API: ${typeof fetch !== 'undefined'}`);
            checks.push(`Promise: ${typeof Promise !== 'undefined'}`);
            checks.push(`AbortController: ${typeof AbortController !== 'undefined'}`);
            
            systemCheck.innerHTML = checks.map(check => {
                const [label, status] = check.split(': ');
                const statusBool = status === 'true';
                return `<div class="log-entry ${statusBool ? 'success' : 'error'}">
                    ${label}: ${status}
                </div>`;
            }).join('');
        }
        
        function clearLogs() {
            debugLog.innerHTML = '';
            console.log('Logs cleared');
        }
        
        async function testBasicFetch() {
            console.log('Testing basic fetch...');
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch('https://api.ipify.org?format=json', {
                    signal: controller.signal,
                    mode: 'cors'
                });
                clearTimeout(timeoutId);
                
                const data = await response.json();
                console.log('Fetch successful:', data);
            } catch (error) {
                console.error('Fetch failed:', error.message);
            }
        }
        
        async function testIPDetection() {
            console.log('Testing IP detection services...');
            const services = [
                'https://api.ipify.org?format=json',
                'https://ipapi.co/json/',
                'https://api.ipgeolocation.io/ipgeo?apiKey=free'
            ];
            
            for (const service of services) {
                try {
                    console.log(`Testing ${service}...`);
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const start = Date.now();
                    const response = await fetch(service, {
                        signal: controller.signal,
                        mode: 'cors'
                    });
                    clearTimeout(timeoutId);
                    
                    const time = Date.now() - start;
                    const data = await response.json();
                    console.log(`Success (${time}ms):`, JSON.stringify(data).substring(0, 100) + '...');
                } catch (error) {
                    console.error(`Failed: ${error.message}`);
                }
            }
        }
        
        async function testFullInit() {
            console.log('Testing full initialization...');
            
            // Load required scripts if not loaded
            if (typeof IPSecurityAnalyzer === 'undefined') {
                console.error('IPSecurityAnalyzer not loaded! Please include script.js');
                return;
            }
            
            try {
                const analyzer = new IPSecurityAnalyzer();
                console.log('Analyzer created');
                await analyzer.init();
                console.log('Init completed');
            } catch (error) {
                console.error('Init failed:', error);
            }
        }
        
        // Load required scripts
        function loadScripts() {
            console.log('Loading required scripts...');
            
            // Load i18n.js
            const i18nScript = document.createElement('script');
            i18nScript.src = 'i18n.js';
            i18nScript.onload = () => {
                console.log('i18n.js loaded');
                
                // Load script.js after i18n.js
                const mainScript = document.createElement('script');
                mainScript.src = 'script.js';
                mainScript.onload = () => {
                    console.log('script.js loaded');
                    checkSystem();
                };
                mainScript.onerror = () => console.error('Failed to load script.js');
                document.head.appendChild(mainScript);
            };
            i18nScript.onerror = () => console.error('Failed to load i18n.js');
            document.head.appendChild(i18nScript);
        }
        
        // Initialize
        window.addEventListener('load', () => {
            console.log('Debug page loaded');
            checkSystem();
            loadScripts();
        });
    </script>
</body>
</html>